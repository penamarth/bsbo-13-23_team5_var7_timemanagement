@startuml
' Define classes and their attributes/methods

class User {
  - id: int
  - name: String
  - email: String
  - passwordHash: String
  + login(email: String, password: String): boolean
  + logout(): void
}

class Employee {
  - role: Role
  + startTaskTime(task: Task): void
  + stopTaskTime(task: Task): void
  + logTaskManually(task: Task, date: Date, hoursSpent: double, comment: String): void
  + createTask(title: String, description: String, deadline: Date): Task
  + assignTask(task: Task, executor: Employee): void
}

class Project {
  - id: int
  - name: String
  - description: String
  - tasks: List<Task>
  + addTask(task: Task): void
  + removeTask(task: Task): void
  + getAllTasks(): List<Task>
  + getActiveTasks(): List<Task>
}

class Task {
  - id: int
  - title: String
  - description: String
  - status: TaskStatus
  - priority: TaskPriority
  - deadline: Date
  - estimatedHours: double
  - startTime: DateTime
  - endTime: DateTime
  - executor: Employee
  - comments: List<Comment>
  - dependentTasks: List<Task>
  + changeStatus(newStatus: TaskStatus): void
  + addComment(comment: Comment): void
  + start(): void
  + finish(): void
}

class Sprint {
  - id: int
  - name: String
  - startDate: Date
  - endDate: Date
  - project: Project
  - tasks: List<Task>
  + addTask(task: Task): void
  + getAvailableTasks(): List<Task>
  + calculateEfficiency(): double
}

class Report {
  - id: int
  - generatedDate: DateTime
  - periodStart: Date
  - periodEnd: Date
  + generateReport(): PDF
}

class Comment {
  - id: int
  - text: String
  - author: Employee
  - createdAt: DateTime
}

class TimeEntry {
  - id: int
  - task: Task
  - date: Date
  - hoursSpent: double
  - startTime: DateTime
  - endTime: DateTime
  - comment: String
}

class ProjectRepository {
  + save(project: Project): void
  + findById(id: int): Project
  + findAll(): List<Project>
  + delete(project: Project): void
}

class InMemoryProjectRepository {
  + save(project: Project): void
  + findById(id: int): Project
  + findAll(): List<Project>
  + delete(project: Project): void
}

' Define enumerations

enum TaskStatus {
  NEW
  IN_PROGRESS
  UNDER_REVIEW
  COMPLETED
  REJECTED
}

enum TaskPriority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum Role {
  EXECUTOR
  REVIEWER
  ADMIN
}

' Define relationships

User <|-- Employee
Employee "1" --> "0..*" Task : executes
Employee "1" --> "0..*" Task : assigns
Employee "1" --> "0..*" Task : creates
Project "1" --> "0..*" Task : contains
Project "1" --> "1" Sprint : uses
Sprint "1" --> "0..*" Task : manages
Task "1" --> "0..*" Comment : contains
Task "1" --> "0..*" TimeEntry : aggregates
Task "1" --> "0..*" Task : depends on
Project "1" --> "0..*" Report : aggregates
ProjectRepository <|-- InMemoryProjectRepository

' Add notes
note right of Employee
  Роль: EXECUTOR, REVIEWER, ADMIN
end note

note right of Sprint
  Спринт на 2 недели.
  Автоматически выбирает задачи из проекта.
end note

note right of Task
  + startTime, endTime — для учета времени
  + dependentTasks — для цепочек задач
end note

@enduml
